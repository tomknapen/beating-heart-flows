[{"id":"3332df14.475c4","type":"tab","label":"Domotica","disabled":false,"info":""},{"id":"cb03a6ee.c51ce8","type":"tab","label":"Deurbel","disabled":false,"info":""},{"id":"81b232fa.7ea2a","type":"tab","label":"Lights","disabled":false,"info":""},{"id":"84c236a0.d32b58","type":"subflow","name":"Google Nest Cast","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"b1fbd0ed.c429b"},{"id":"55e56a51.8616e4"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"9dbf1550.7a44c8","type":"subflow","name":"Button","info":"","category":"","in":[],"out":[{"x":480,"y":300,"wires":[{"id":"a017af03.e93be","port":0}]},{"x":480,"y":340,"wires":[{"id":"a017af03.e93be","port":1}]},{"x":480,"y":380,"wires":[{"id":"a017af03.e93be","port":2}]}],"env":[{"name":"location","type":"str","value":"","ui":{"icon":"font-awesome/fa-map-marker","type":"select","opts":{"opts":[{"l":{"en-US":"downstairs"},"v":"downstairs"},{"l":{"en-US":"upstairs"},"v":"upstairs"}]},"label":{}}},{"name":"device","type":"str","value":"","ui":{"icon":"font-awesome/fa-microchip","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"pin","type":"str","value":"","ui":{"icon":"font-awesome/fa-map-pin","type":"input","opts":{"types":["str"]},"label":{}}}],"color":"#A6BBCF","icon":"node-red-dashboard/ui_button.png","status":{"x":640,"y":240,"wires":[{"id":"36f926ec.e86dda","port":0}]}},{"id":"7057f1ef.030e7","type":"subflow","name":"Light","info":"","category":"","in":[{"x":60,"y":140,"wires":[{"id":"f9ec0eb0.d4463"}]}],"out":[{"x":200,"y":660,"wires":[{"id":"2c1a2ca3.ecfe94","port":0}]}],"env":[{"name":"name","type":"str","value":"","ui":{"icon":"font-awesome/fa-tag","label":{},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"location","type":"str","value":"","ui":{"icon":"font-awesome/fa-map-marker","type":"select","opts":{"opts":[{"l":{"en-US":"downstairs"},"v":"downstairs"},{"l":{"en-US":"upstairs"},"v":"upstairs"}]},"label":{}}},{"name":"number","type":"str","value":"","ui":{"icon":"font-awesome/fa-sort-numeric-asc","type":"input","opts":{"types":["str"]},"label":{}}}],"color":"#3FADB5","icon":"font-awesome/fa-lightbulb-o"},{"id":"6f1eb918.3cb018","type":"subflow","name":"Relay","info":"","category":"","in":[{"x":120,"y":120,"wires":[{"id":"e0d3f10f.b6248"}]}],"out":[{"x":240,"y":680,"wires":[{"id":"5774a88e.5793e8","port":0}]}],"env":[{"name":"name","type":"str","value":"","ui":{"icon":"font-awesome/fa-tag","label":{},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"location","type":"str","value":"","ui":{"icon":"font-awesome/fa-map-marker","type":"select","opts":{"opts":[{"l":{"en-US":"downstairs"},"v":"downstairs"},{"l":{"en-US":"upstairs"},"v":"upstairs"}]},"label":{}}},{"name":"number","type":"str","value":"","ui":{"icon":"font-awesome/fa-sort-numeric-asc","type":"input","opts":{"types":["str"]},"label":{}}}],"color":"#3FADB5","inputLabels":["ON/OFF/TOGGLE"],"outputLabels":["state"],"icon":"node-red-contrib-time-range-switch/switch.png"},{"id":"a6fb0933.f024a8","type":"mqtt-broker","z":"","name":"beating-heart-mqtt","broker":"192.168.1.201","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"edaa9f3b.acba7","type":"telegrambot-config","z":"","botname":"Beating Heart","usernames":"StrikingVampire,K_irsten","chatIds":"932931836,1014836535","pollInterval":"300"},{"id":"7511f7e9.e3aef8","type":"ui_tab","z":"","name":"Waterstraat 39","icon":"dashboard","disabled":false,"hidden":false},{"id":"b61c32fe.24725","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Waterstraat 39","hideToolbar":"true","allowSwipe":"true","lockMenu":"true","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"2090962c.d6e64a","type":"ui_tab","z":"","name":"All lights","icon":"dashboard","disabled":false,"hidden":false},{"id":"c7593455.cae918","type":"ui_group","z":"","name":"All","tab":"2090962c.d6e64a","disp":false,"width":"6","collapse":false},{"id":"c5a0ce1b.587c5","type":"ui_group","z":"","name":"Beneden","tab":"7511f7e9.e3aef8","disp":true,"width":"6","collapse":false},{"id":"3ebf4341.e571dc","type":"cast-to-client","z":"84c236a0.d32b58","name":"Google Nest Mini Black","url":"","contentType":"","message":"","language":"","ip":"192.168.1.230","port":"","volume":"","x":850,"y":300,"wires":[[]]},{"id":"f9ffe2f3.6dfa5","type":"cast-to-client","z":"84c236a0.d32b58","name":"Google Nest Mini White","url":"","contentType":"","message":"","language":"nl","ip":"192.168.1.231","port":"","volume":"","x":850,"y":360,"wires":[[]]},{"id":"b1fbd0ed.c429b","type":"change","z":"84c236a0.d32b58","name":"set volume","rules":[{"t":"set","p":"payload.volume","pt":"msg","to":"30","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":300,"wires":[["3ebf4341.e571dc"]]},{"id":"bf1f8fee.78142","type":"change","z":"84c236a0.d32b58","name":"set volume","rules":[{"t":"set","p":"payload.volume","pt":"msg","to":"20","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":360,"wires":[["f9ffe2f3.6dfa5"]]},{"id":"85b53517.1d2558","type":"mqtt out","z":"cb03a6ee.c51ce8","name":"","topic":"striva/f/deurbel","qos":"1","retain":"","broker":"a6fb0933.f024a8","x":280,"y":60,"wires":[]},{"id":"73d4d693.890d58","type":"inject","z":"cb03a6ee.c51ce8","name":"Push","topic":"deurbel","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":60,"wires":[["85b53517.1d2558"]]},{"id":"ecb93435.c49ff8","type":"mqtt in","z":"cb03a6ee.c51ce8","name":"","topic":"striva/f/deurbel","qos":"1","datatype":"json","broker":"a6fb0933.f024a8","x":120,"y":200,"wires":[["de009c82.fc62b"]]},{"id":"de009c82.fc62b","type":"change","z":"cb03a6ee.c51ce8","name":"Chime","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"message\":\"Ding dong\",\"language\":\"en\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":200,"wires":[["e0a02e6d.3f02e","c2e443bc.18aa2","e5d88cf1.def83"]]},{"id":"e0a02e6d.3f02e","type":"subflow:84c236a0.d32b58","z":"cb03a6ee.c51ce8","name":"","env":[],"x":470,"y":200,"wires":[]},{"id":"55e56a51.8616e4","type":"time-range-switch","z":"84c236a0.d32b58","name":"08:00 - 19:00","lat":"","lon":"","startTime":"08:00","endTime":"19:00","startOffset":0,"endOffset":0,"x":410,"y":360,"wires":[["bf1f8fee.78142"],[]]},{"id":"c2e443bc.18aa2","type":"telegrambot-notify","z":"cb03a6ee.c51ce8","name":"Send message to Tom","bot":"edaa9f3b.acba7","chatId":"932931836","message":"Someone's at the door!","parseMode":"","x":480,"y":280,"wires":[]},{"id":"b58648fb.5d4ea8","type":"webhookrelay","z":"81b232fa.7ea2a","buckets":"ifttt","x":100,"y":140,"wires":[["a43b91cf.516a2","e89316c5.427408"]]},{"id":"b368aefd.13248","type":"json","z":"81b232fa.7ea2a","name":"","property":"payload","action":"","pretty":false,"x":540,"y":140,"wires":[["c7ac5338.7b993"]]},{"id":"c7ac5338.7b993","type":"switch","z":"81b232fa.7ea2a","name":"","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"lights_livingroom_on","vt":"str"},{"t":"eq","v":"lights_livingroom_off","vt":"str"},{"t":"eq","v":"lights_kitchen_on","vt":"str"},{"t":"eq","v":"lights_kitchen_off","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":270,"y":200,"wires":[["25c0d12f.e1fd8e"],["a9009f54.7655f"],["f5cc80ab.3b33e"],["7b9e535e.04779c"]]},{"id":"25c0d12f.e1fd8e","type":"change","z":"81b232fa.7ea2a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"lights/0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":200,"wires":[[]]},{"id":"a9009f54.7655f","type":"change","z":"81b232fa.7ea2a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"lights/0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":240,"wires":[[]]},{"id":"f5cc80ab.3b33e","type":"change","z":"81b232fa.7ea2a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"lights/5","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":280,"wires":[[]]},{"id":"7b9e535e.04779c","type":"change","z":"81b232fa.7ea2a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"lights/5","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":320,"wires":[[]]},{"id":"a43b91cf.516a2","type":"change","z":"81b232fa.7ea2a","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":140,"wires":[["b368aefd.13248"]]},{"id":"e5d88cf1.def83","type":"telegrambot-notify","z":"cb03a6ee.c51ce8","name":"Send message to Kirsten","bot":"edaa9f3b.acba7","chatId":"1014836535","message":"Someone's at the door!","parseMode":"","x":490,"y":340,"wires":[]},{"id":"e89316c5.427408","type":"debug","z":"81b232fa.7ea2a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":220,"y":40,"wires":[]},{"id":"5d0af138.ca1ee","type":"mqtt in","z":"9dbf1550.7a44c8","name":"","topic":"cmnd/button/#","qos":"2","datatype":"auto","broker":"a6fb0933.f024a8","x":200,"y":80,"wires":[["51cd4815.e77578"]]},{"id":"51cd4815.e77578","type":"change","z":"9dbf1550.7a44c8","name":"to button","rules":[{"t":"set","p":"button.location","pt":"msg","to":"msg.topic.$split('/')[2]","tot":"jsonata"},{"t":"set","p":"button.device","pt":"msg","to":"msg.topic.$split('/')[3]","tot":"jsonata"},{"t":"set","p":"button.pin","pt":"msg","to":"msg.topic.$split('/')[4]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":220,"y":140,"wires":[["79cfd56f.782bdc"]]},{"id":"a017af03.e93be","type":"switch","z":"9dbf1550.7a44c8","name":"button state","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"single","vt":"str"},{"t":"eq","v":"double","vt":"str"},{"t":"eq","v":"hold","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":310,"y":340,"wires":[[],[],[],[]]},{"id":"79cfd56f.782bdc","type":"switch","z":"9dbf1550.7a44c8","name":"check location","property":"button.location","propertyType":"msg","rules":[{"t":"eq","v":"location","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":280,"y":200,"wires":[["be81bf5d.04189"]]},{"id":"be81bf5d.04189","type":"switch","z":"9dbf1550.7a44c8","name":"check device","property":"button.device","propertyType":"msg","rules":[{"t":"eq","v":"device","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":240,"wires":[["1e6576c8.b88109"]]},{"id":"1e6576c8.b88109","type":"switch","z":"9dbf1550.7a44c8","name":"check pin","property":"button.pin","propertyType":"msg","rules":[{"t":"eq","v":"pin","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":260,"y":280,"wires":[["a017af03.e93be","36f926ec.e86dda"]]},{"id":"36f926ec.e86dda","type":"template","z":"9dbf1550.7a44c8","name":"","field":"status","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{button.state}}","output":"str","x":520,"y":240,"wires":[[]]},{"id":"184555c5.294fea","type":"telegrambot-switch","z":"81b232fa.7ea2a","name":"Which lights?","bot":"edaa9f3b.acba7","chatId":"","question":"Welke lampen wil je bedienen?","answers":["Keuken","Living","Kerstboom"],"outputs":3,"autoAnswerCallback":true,"timeoutValue":"","timeoutUnits":"","x":220,"y":860,"wires":[["ab9eff09.23e7c"],["9ab40c09.c7a9"],["994a38e8.e359a8"]]},{"id":"39d9c4bb.02229c","type":"telegrambot-switch","z":"81b232fa.7ea2a","name":"On/off","bot":"edaa9f3b.acba7","chatId":"","question":"Aan doen, of uit doen?","answers":["Aan","Uit","Verras mij"],"outputs":3,"autoAnswerCallback":true,"timeoutValue":"","timeoutUnits":"","x":570,"y":860,"wires":[["2c4741bb.b2b26e"],["5d3984e4.896d7c"],["5e1606ba.d775b8"]]},{"id":"ab9eff09.23e7c","type":"change","z":"81b232fa.7ea2a","name":"keuken","rules":[{"t":"set","p":"light","pt":"msg","to":"keuken","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":820,"wires":[["39d9c4bb.02229c"]]},{"id":"9ab40c09.c7a9","type":"change","z":"81b232fa.7ea2a","name":"living","rules":[{"t":"set","p":"light","pt":"msg","to":"living","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":860,"wires":[["39d9c4bb.02229c"]]},{"id":"994a38e8.e359a8","type":"change","z":"81b232fa.7ea2a","name":"kerstboom","rules":[{"t":"set","p":"light","pt":"msg","to":"kerstboom","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":900,"wires":[["39d9c4bb.02229c"]]},{"id":"2c4741bb.b2b26e","type":"change","z":"81b232fa.7ea2a","name":"aan","rules":[{"t":"set","p":"state","pt":"msg","to":"aan","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":820,"wires":[["ddf49183.47843"]]},{"id":"5d3984e4.896d7c","type":"change","z":"81b232fa.7ea2a","name":"uit","rules":[{"t":"set","p":"state","pt":"msg","to":"uit","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":860,"wires":[["ddf49183.47843"]]},{"id":"5e1606ba.d775b8","type":"change","z":"81b232fa.7ea2a","name":"verrassing","rules":[{"t":"set","p":"state","pt":"msg","to":"VERRASSING!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":900,"wires":[["6743c20c.f33c9c"]]},{"id":"c645bb9d.0d8138","type":"telegrambot-notify","z":"81b232fa.7ea2a","name":"","bot":"edaa9f3b.acba7","chatId":"","message":"","parseMode":"","x":1160,"y":860,"wires":[]},{"id":"ddf49183.47843","type":"template","z":"81b232fa.7ea2a","name":"aan/uit message","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Ok, ik doe de {{light}} verlichting {{state}}.","output":"str","x":920,"y":840,"wires":[["c645bb9d.0d8138"]]},{"id":"6743c20c.f33c9c","type":"template","z":"81b232fa.7ea2a","name":"verrassing message","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Kijk wat er nu gebeurt met de {{light}} verlichting: FLIKKER FLIKKER!","output":"str","x":940,"y":900,"wires":[["c645bb9d.0d8138"]]},{"id":"77fee143.711d7","type":"telegrambot-command","z":"81b232fa.7ea2a","name":"lights","bot":"edaa9f3b.acba7","command":"^l(?:(?:ights?)|(?:icht(?:en)?))?$","commandType":"re","commandCase":false,"x":70,"y":860,"wires":[["184555c5.294fea"]]},{"id":"2f590c66.f5fc64","type":"subflow:9dbf1550.7a44c8","z":"3332df14.475c4","name":"1.d | Raam inpandig terras | links","env":[{"name":"location","value":"upstairs","type":"str"},{"name":"device","value":"1","type":"str"},{"name":"pin","value":"53","type":"str"}],"x":150,"y":120,"wires":[["3c0477ca.6f1d88"],["4d96b71a.545318"],["afa1e553.80e298"]]},{"id":"e0bed699.abfb78","type":"subflow:9dbf1550.7a44c8","z":"3332df14.475c4","name":"1.d | Raam inpandig terras | rechts","env":[{"name":"location","value":"upstairs","type":"str"},{"name":"device","value":"1","type":"str"},{"name":"pin","value":"52","type":"str"}],"x":160,"y":180,"wires":[["37a8e73.774dd18"],[],["1b311b55.464845"]]},{"id":"3c0477ca.6f1d88","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":100,"wires":[["8f61ed8d.84ce3"]]},{"id":"dc16fe2.e2851","type":"mqtt in","z":"7057f1ef.030e7","name":"","topic":"stat/light/#","qos":"2","datatype":"auto","broker":"a6fb0933.f024a8","x":80,"y":380,"wires":[["2038d004.a6ce7"]]},{"id":"2c1a2ca3.ecfe94","type":"change","z":"7057f1ef.030e7","name":"","rules":[{"t":"set","p":"status","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":220,"y":600,"wires":[[]]},{"id":"2038d004.a6ce7","type":"change","z":"7057f1ef.030e7","name":"to light","rules":[{"t":"set","p":"light.location","pt":"msg","to":"msg.topic.$split('/')[2]","tot":"jsonata"},{"t":"set","p":"light.number","pt":"msg","to":"msg.topic.$split('/')[3]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":110,"y":440,"wires":[["b727ef0a.6f429"]]},{"id":"b727ef0a.6f429","type":"switch","z":"7057f1ef.030e7","name":"check location","property":"light.location","propertyType":"msg","rules":[{"t":"eq","v":"location","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":180,"y":500,"wires":[["16aca85d.aa0d08"]]},{"id":"16aca85d.aa0d08","type":"switch","z":"7057f1ef.030e7","name":"check number","property":"light.number","propertyType":"msg","rules":[{"t":"eq","v":"number","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":180,"y":540,"wires":[["2c1a2ca3.ecfe94"]]},{"id":"f9ec0eb0.d4463","type":"switch","z":"7057f1ef.030e7","name":"ON/OFF/TOGGLE/SCENE","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"},{"t":"eq","v":"TOGGLE","vt":"str"},{"t":"eq","v":"SCENE","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":240,"y":140,"wires":[["276c9db.69ba862"],["276c9db.69ba862"],["276c9db.69ba862"],[]]},{"id":"276c9db.69ba862","type":"change","z":"7057f1ef.030e7","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"$join(\t   [\t       'cmnd',\t       'light',\t       $env('location'),\t       $env('number'),\t       'POWER'\t   ],\t   '/'\t)\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":140,"wires":[["1eedcbcb.cff504"]]},{"id":"1eedcbcb.cff504","type":"mqtt out","z":"7057f1ef.030e7","name":"cmnd/light/location/number","topic":"","qos":"2","retain":"true","broker":"a6fb0933.f024a8","x":740,"y":140,"wires":[]},{"id":"8f61ed8d.84ce3","type":"subflow:7057f1ef.030e7","z":"3332df14.475c4","name":"1.09 | Zetel: wandlicht keuken","env":[{"name":"name","value":"Zetel: kant keuken","type":"str"},{"name":"location","value":"upstairs","type":"str"},{"name":"number","value":"2","type":"str"}],"x":1290,"y":100,"wires":[[]]},{"id":"a880eeb9.6c196","type":"subflow:7057f1ef.030e7","z":"3332df14.475c4","name":"1.05 | Zetel: wandlicht raam","env":[{"name":"name","value":"Zetel: kant raam","type":"str"},{"name":"location","value":"upstairs","type":"str"},{"name":"number","value":"1","type":"str"}],"x":1280,"y":180,"wires":[[]]},{"id":"37a8e73.774dd18","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":180,"wires":[["a880eeb9.6c196"]]},{"id":"1b311b55.464845","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":320,"wires":[["11fe056e.eba1bb"]]},{"id":"1dca2b32.c96535","type":"subflow:9dbf1550.7a44c8","z":"3332df14.475c4","name":"1.d | Raam speelhoek | links","env":[{"name":"location","value":"upstairs","type":"str"},{"name":"device","value":"1","type":"str"},{"name":"pin","value":"51","type":"str"}],"x":140,"y":260,"wires":[["3c0477ca.6f1d88"],[],[]]},{"id":"fa45c5e1.5b1e18","type":"subflow:9dbf1550.7a44c8","z":"3332df14.475c4","name":"1.d | Raam speelhoek| rechts","env":[{"name":"location","value":"upstairs","type":"str"},{"name":"device","value":"1","type":"str"},{"name":"pin","value":"50","type":"str"}],"x":140,"y":320,"wires":[["37a8e73.774dd18"],[],[]]},{"id":"2474c0c1.2727d","type":"subflow:9dbf1550.7a44c8","z":"3332df14.475c4","name":"0.k | Kamer Marvin bed","env":[{"name":"location","value":"downstairs","type":"str"},{"name":"device","value":"1","type":"str"},{"name":"pin","value":"17","type":"str"}],"x":120,"y":480,"wires":[["2a538788.f64a48"],[],["25ab7afa.5bad46"]]},{"id":"2a538788.f64a48","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":460,"wires":[["eaa06de8.6adfe"]]},{"id":"eaa06de8.6adfe","type":"subflow:7057f1ef.030e7","z":"3332df14.475c4","name":"Kleurlamp Marvin","env":[{"name":"name","value":"Kleurlamp Marvin","type":"str"},{"name":"location","value":"downstairs","type":"str"},{"name":"number","value":"1","type":"str"}],"x":650,"y":460,"wires":[[]]},{"id":"f17d97aa.bec598","type":"subflow:7057f1ef.030e7","z":"3332df14.475c4","name":"Hoofdverlichting Marvin 2","env":[{"name":"name","value":"Hoofdverlichting Marvin 2","type":"str"},{"name":"location","value":"downstairs","type":"str"},{"name":"number","value":"3","type":"str"}],"x":670,"y":540,"wires":[[]]},{"id":"f05aa386.3b323","type":"subflow:7057f1ef.030e7","z":"3332df14.475c4","name":"Hoofdverlichting Marvin 3","env":[{"name":"name","value":"Hoofdverlichting Marvin 3","type":"str"},{"name":"location","value":"downstairs","type":"str"},{"name":"number","value":"4","type":"str"}],"x":670,"y":580,"wires":[[]]},{"id":"b6027b8e.de4c48","type":"subflow:7057f1ef.030e7","z":"3332df14.475c4","name":"Hoofdverlichting Marvin 1","env":[{"name":"name","value":"Hoofdverlichting Marvin 1","type":"str"},{"name":"location","value":"downstairs","type":"str"},{"name":"number","value":"2","type":"str"}],"x":670,"y":500,"wires":[[]]},{"id":"25ab7afa.5bad46","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":500,"wires":[["b6027b8e.de4c48","f17d97aa.bec598","f05aa386.3b323"]]},{"id":"afa1e553.80e298","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":260,"wires":[["c115732e.7663c"]]},{"id":"4d96b71a.545318","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":140,"wires":[["f0e4d1d5.361dd"]]},{"id":"99d63174.b536","type":"inject","z":"3332df14.475c4","name":"20:00","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 20 * * *","once":false,"onceDelay":0.1,"x":760,"y":20,"wires":[["e26fae37.21a83"]]},{"id":"e26fae37.21a83","type":"change","z":"3332df14.475c4","name":"ON","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":20,"wires":[["8f61ed8d.84ce3","a880eeb9.6c196"]]},{"id":"c92f4be6.c99e48","type":"inject","z":"3332df14.475c4","name":"00:00","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 00 * * *","once":false,"onceDelay":0.1,"x":760,"y":60,"wires":[["28fa542d.94277c"]]},{"id":"28fa542d.94277c","type":"change","z":"3332df14.475c4","name":"OFF","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":60,"wires":[["8f61ed8d.84ce3","a880eeb9.6c196"]]},{"id":"3b666122.37c89e","type":"trigger","z":"3332df14.475c4","op1":"","op2":"OFF","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"min","reset":"","bytopic":"all","name":"Switch off after 10 minutes","x":980,"y":140,"wires":[["f0e4d1d5.361dd"]]},{"id":"e47597fa.691898","type":"inject","z":"3332df14.475c4","name":"20:15","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"15 20 * * *","once":false,"onceDelay":0.1,"x":210,"y":560,"wires":[["3c4d1b2c.7ef3e4"]]},{"id":"4de5788c.fbe208","type":"inject","z":"3332df14.475c4","name":"07:00 (week)","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 07 * * 1,2,3,4,5","once":false,"onceDelay":0.1,"x":140,"y":600,"wires":[["45abe468.c1d23c"]]},{"id":"3c4d1b2c.7ef3e4","type":"change","z":"3332df14.475c4","name":"ON","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":560,"wires":[["eaa06de8.6adfe","b6027b8e.de4c48","f17d97aa.bec598","f05aa386.3b323"]]},{"id":"45abe468.c1d23c","type":"change","z":"3332df14.475c4","name":"OFF","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":600,"wires":[["eaa06de8.6adfe","b6027b8e.de4c48","f17d97aa.bec598","f05aa386.3b323","7793022.74e11fc"]]},{"id":"7793022.74e11fc","type":"subflow:7057f1ef.030e7","z":"3332df14.475c4","name":"Kleurlamp Sam","env":[{"name":"name","value":"Kleurlamp Sam","type":"str"},{"name":"location","value":"downstairs","type":"str"},{"name":"number","value":"5","type":"str"}],"x":640,"y":620,"wires":[[]]},{"id":"64d4c91b.67b568","type":"inject","z":"3332df14.475c4","name":"18:30","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"30 18 * * *","once":false,"onceDelay":0.1,"x":210,"y":640,"wires":[["83d6342f.6ad388","5695a00.62fa26"]]},{"id":"83d6342f.6ad388","type":"change","z":"3332df14.475c4","name":"ON","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":640,"wires":[["7793022.74e11fc"]]},{"id":"5a8637c0.170b68","type":"subflow:7057f1ef.030e7","z":"3332df14.475c4","name":"Gang 1","env":[{"name":"name","value":"Gang 1","type":"str"},{"name":"location","value":"downstairs","type":"str"},{"name":"number","value":"6","type":"str"}],"x":660,"y":780,"wires":[[]]},{"id":"9cf352af.0c329","type":"subflow:7057f1ef.030e7","z":"3332df14.475c4","name":"Gang 2","env":[{"name":"name","value":"Gang 2","type":"str"},{"name":"location","value":"downstairs","type":"str"},{"name":"number","value":"7","type":"str"}],"x":660,"y":820,"wires":[[]]},{"id":"5695a00.62fa26","type":"change","z":"3332df14.475c4","name":"ON","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":780,"wires":[["5a8637c0.170b68","9cf352af.0c329"]]},{"id":"b9b3e9d2.8fddf8","type":"change","z":"3332df14.475c4","name":"OFF","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":820,"wires":[["5a8637c0.170b68","9cf352af.0c329"]]},{"id":"d5d4546e.209788","type":"inject","z":"3332df14.475c4","name":"07:30 (weekend)","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"30 07 * * 6,0","once":false,"onceDelay":0.1,"x":150,"y":720,"wires":[["45abe468.c1d23c"]]},{"id":"917ac7b1.ac2f98","type":"inject","z":"3332df14.475c4","name":"08:00 alle dagen","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 08 * * *","once":false,"onceDelay":0.1,"x":150,"y":760,"wires":[["b9b3e9d2.8fddf8"]]},{"id":"414f76b2.d3df78","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":920,"wires":[["afcb8988.f7dc68"]]},{"id":"8488fec1.fec19","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":960,"wires":[["dc270186.111d1"]]},{"id":"6a63caa2.764644","type":"ui_button","z":"7057f1ef.030e7","name":"","group":"c7593455.cae918","order":2,"width":0,"height":0,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":430,"y":40,"wires":[["7472ffb3.f4af1"]]},{"id":"7472ffb3.f4af1","type":"change","z":"7057f1ef.030e7","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":40,"wires":[["f9ec0eb0.d4463"]]},{"id":"9ee3a679.391d58","type":"inject","z":"7057f1ef.030e7","name":"Init","topic":"","payload":"name","payloadType":"env","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":40,"wires":[["cc6f028d.9f7d6"]]},{"id":"cc6f028d.9f7d6","type":"change","z":"7057f1ef.030e7","name":"","rules":[{"t":"set","p":"label","pt":"msg","to":"name","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":40,"wires":[["6a63caa2.764644"]]},{"id":"2c9950.2efbb6b","type":"mqtt in","z":"6f1eb918.3cb018","name":"","topic":"stat/relay/#","qos":"2","datatype":"auto","broker":"a6fb0933.f024a8","x":120,"y":400,"wires":[["a570092f.0e5d78"]]},{"id":"5774a88e.5793e8","type":"change","z":"6f1eb918.3cb018","name":"","rules":[{"t":"set","p":"status","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":260,"y":620,"wires":[[]]},{"id":"a570092f.0e5d78","type":"change","z":"6f1eb918.3cb018","name":"to relay","rules":[{"t":"set","p":"relay.location","pt":"msg","to":"msg.topic.$split('/')[2]","tot":"jsonata"},{"t":"set","p":"relay.number","pt":"msg","to":"msg.topic.$split('/')[3]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":460,"wires":[["3471a5bf.4f9a9a"]]},{"id":"3471a5bf.4f9a9a","type":"switch","z":"6f1eb918.3cb018","name":"check location","property":"relay.location","propertyType":"msg","rules":[{"t":"eq","v":"location","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":220,"y":520,"wires":[["49f6867e.9709c8"]]},{"id":"49f6867e.9709c8","type":"switch","z":"6f1eb918.3cb018","name":"check number","property":"relay.number","propertyType":"msg","rules":[{"t":"eq","v":"number","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":220,"y":560,"wires":[["5774a88e.5793e8"]]},{"id":"e0d3f10f.b6248","type":"switch","z":"6f1eb918.3cb018","name":"ON/OFF/TOGGLE","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"},{"t":"eq","v":"TOGGLE","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":270,"y":120,"wires":[["110635fa.9bf96a"],["110635fa.9bf96a"],["6b4d3959.d9e0f8"]]},{"id":"110635fa.9bf96a","type":"change","z":"6f1eb918.3cb018","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"$join(\t   [\t       'cmnd',\t       'relay',\t       $env('location'),\t       $env('number')\t   ],\t   '/'\t)\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":220,"wires":[["6dc12494.f3507c"]]},{"id":"6dc12494.f3507c","type":"mqtt out","z":"6f1eb918.3cb018","name":"cmnd/relay/location/number","topic":"","qos":"2","retain":"true","broker":"a6fb0933.f024a8","x":820,"y":220,"wires":[]},{"id":"6b4d3959.d9e0f8","type":"switch","z":"6f1eb918.3cb018","name":"toggle","property":"status","propertyType":"flow","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":200,"wires":[["aab437ea.ab0898"],["34d3ff1c.a4d94"]]},{"id":"34d3ff1c.a4d94","type":"change","z":"6f1eb918.3cb018","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":300,"wires":[["110635fa.9bf96a"]]},{"id":"aab437ea.ab0898","type":"change","z":"6f1eb918.3cb018","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":260,"wires":[["110635fa.9bf96a"]]},{"id":"11fe056e.eba1bb","type":"subflow:6f1eb918.3cb018","z":"3332df14.475c4","name":"1.03a | Berging boven","env":[{"name":"name","value":"1.03a | Berging boven","type":"str"},{"name":"location","value":"upstairs","type":"str"},{"name":"number","value":"1","type":"str"}],"x":740,"y":320,"wires":[[]]},{"id":"c115732e.7663c","type":"subflow:6f1eb918.3cb018","z":"3332df14.475c4","name":"1.04 | Eetkamer","env":[{"name":"name","value":"1.04 | Eetkamer","type":"str"},{"name":"location","value":"upstairs","type":"str"},{"name":"number","value":"2","type":"str"}],"x":720,"y":260,"wires":[[]]},{"id":"f0e4d1d5.361dd","type":"subflow:6f1eb918.3cb018","z":"3332df14.475c4","name":"1.02 | Wc boven","env":[{"name":"name","value":"1.02 | Wc boven","type":"str"},{"name":"location","value":"upstairs","type":"str"},{"name":"number","value":"3","type":"str"}],"x":720,"y":140,"wires":[["3b666122.37c89e"]]},{"id":"afcb8988.f7dc68","type":"subflow:6f1eb918.3cb018","z":"3332df14.475c4","name":"Dressing","env":[{"name":"name","value":"Dressing","type":"str"},{"name":"location","value":"downstairs","type":"str"},{"name":"number","value":"1","type":"str"}],"x":420,"y":920,"wires":[[]]},{"id":"dc270186.111d1","type":"subflow:6f1eb918.3cb018","z":"3332df14.475c4","name":"Berging","env":[{"name":"name","value":"Berging","type":"str"},{"name":"location","value":"downstairs","type":"str"},{"name":"number","value":"2","type":"str"}],"x":420,"y":960,"wires":[[]]},{"id":"e90a9f2f.c634b","type":"ui_button","z":"6f1eb918.3cb018","name":"","group":"c7593455.cae918","order":2,"width":0,"height":0,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":410,"y":40,"wires":[["6c52363b.ef87a8"]]},{"id":"6c52363b.ef87a8","type":"change","z":"6f1eb918.3cb018","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":40,"wires":[["e0d3f10f.b6248"]]},{"id":"eb3276dc.ea0878","type":"inject","z":"6f1eb918.3cb018","name":"Init","topic":"","payload":"name","payloadType":"env","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":90,"y":40,"wires":[["3295e76c.b93218"]]},{"id":"3295e76c.b93218","type":"change","z":"6f1eb918.3cb018","name":"","rules":[{"t":"set","p":"label","pt":"msg","to":"name","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":40,"wires":[["e90a9f2f.c634b"]]},{"id":"9d5ca907.6bc868","type":"ui_button","z":"3332df14.475c4","name":"","group":"c5a0ce1b.587c5","order":0,"width":0,"height":0,"passthru":false,"label":"Dressing","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":120,"y":920,"wires":[["414f76b2.d3df78"]]},{"id":"297aac55.9b1e84","type":"ui_button","z":"3332df14.475c4","name":"","group":"c5a0ce1b.587c5","order":0,"width":0,"height":0,"passthru":false,"label":"Berging","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":120,"y":960,"wires":[["8488fec1.fec19"]]},{"id":"5768288a.f36398","type":"ui_button","z":"3332df14.475c4","name":"","group":"c5a0ce1b.587c5","order":0,"width":0,"height":0,"passthru":false,"label":"Gang","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":350,"y":860,"wires":[["d8d4a431.d75658"]]},{"id":"d8d4a431.d75658","type":"change","z":"3332df14.475c4","name":"toggle","rules":[{"t":"set","p":"payload","pt":"msg","to":"TOGGLE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":860,"wires":[["5a8637c0.170b68","9cf352af.0c329"]]}]